// random_Tracks

// This script will temporarily suspend I.R control until it finishes.



var tracks = process.argv.slice(2);
if (tracks <= 0)  // no arguments passed via plugin or remote
{
  tracks =25;  
}
function rand(max, min) {
        return Math.floor(Math.random() * (+max - +min)) + min;
}

var i = 0;
var track = 0;
var io = require('socket.io-client');
var socket = io.connect('http://localhost:3000');
socket.emit('stop');
socket.emit('clearQueue');
('browseLibrary', {'uri':'albums://'});
socket.on('pushBrowseLibrary',function(data) {
  item = data.navigation.lists[0].items[0];
  if (item.type == 'song') {
    try {
      while (item.type == 'song') {
        item = data.navigation.lists[0].items[i];
        i++;
      }
    }
    catch(err) {
      i-- ;
      track = rand(i, 0);
      item = data.navigation.lists[0].items[track];
      i = 0;
    }
    socket.emit('addToQueue', {'uri':item.uri});
  } else {
     var list = data.navigation.lists[0].items;
     var random = rand(list.length - 1, 0);
     select = list[random];
     socket.emit('browseLibrary', {'uri':select.uri});
  }
});

socket.on('pushQueue', function(data) {
      if (data.length == tracks) {
            socket.disconnect()
      } else {
        if (data && data.length == 1) {
          socket.emit("play",{"value":0});
        }
        socket.emit('browseLibrary', {'uri':'albums://'});
      }
});




